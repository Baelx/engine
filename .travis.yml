env:
  global:
  - CC_TEST_REPORTER_ID=7270ff0025c47f5c76e29b2e422f2c99615339a5abcfe0d31074b7818edf4054
  - secure: Nx+4nuH/TKqNVcNwHGG6UUvnsyZpVghE46axsQ2Wp2iyGZH4yqr0KtjtySwpS6NW8wI90CX1ZKcp9UOFMUvRNIcSHvtNnisnx67SZQ5EcluN6tpp0zV09PYbANsOTBvO/tfJCRsOt2Jar8uAfYcyVI4doZDKfA1eo9h6GhDIOBhe+MKElawoqrGWQndzIkUbajW1hQA/kv2MgaltsT0MgQn3aK89HEOwmcfSZliN/L+m/SUK/rasdktSe0V7BC2g5tjIH+UUpOwEZauYyuUFoL3R7kYb/aQqB5HIkK7iiBncE2R60VdXWQmuIipn+CuU0RwrLkMcbN5H9zRAGzQElxzmynbCkowvUdvSoieJK03HQUdn0XER3+d3OOz/pNrDFQ32n12qI7TyYQt0Iq1op7wERIOSm0rS1ctF1JwpTgxEKkRcowA8l01SMMuj+KSsM9Y/TgMwQVn6Az3ClBuO/8gvjBKtopxzpqx+PFVUhTz+E0CyOhstCF3eiKRljBUmUVK6vHJOmUfdUGi4Vy1AnC1ZBttP2B6zPPmuZjNs6LOq8JRphFUNaxU8sMwu8TM/9I7LY6dfgpodbLy2BoAy4eGzUcVp6SoZnN+MNuRIRpNshHaQPWJ8mmTjnuCJLjvni8TRc2xu6yBiR3hed8drK4JJ8Vj4/WWwtMqaIEjwrLA=
language: go
go:
- 1.10.2
go_import_path: github.com/battlesnakeio/engine
services:
- docker
before_script:
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- "./cc-test-reporter before-build"
stages:
  - lint
  - test
  - deploy
    if: branch = master AND tag IS present
jobs:
  include:
  - stage: lint
    script:
    - go get -u github.com/alecthomas/gometalinter
    - gometalinter --install
    - make lint
  - stage: test
    script:
    - docker run -d --name=battlesnake-redis --rm -t -p 6379:6379 redis
    - REDIS_URL=redis://127.0.0.1:6379 make test
    - cp coverage.txt c.out
    - "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
    - bash <(curl -s https://codecov.io/bash)
    - docker rm -f battlesnake-redis
    - rm ./cc-test-reporter
  - script: make test-e2e
  - stage: deploy
    script: skip
    deploy:
    - provider: script
      skip_cleanup: true
      script: curl -sL https://git.io/goreleaser | bash
